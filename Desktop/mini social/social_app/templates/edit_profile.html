<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Profile - Mini Social</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'styles.css' %}?v=2">
</head>

<body>
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-brand">Mini Social</div>
            <div class="navbar-links">
                <a href="{% url 'home' %}">Home</a>
                <a href="{% url 'profile' request.user.id %}">Profile</a>
                <a href="{% url 'logout' %}">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        {% if messages %}
        {% for message in messages %}
        <div class="message {% if message.tags %}{{ message.tags }}-message{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
        {% endif %}

        <div class="edit-form-card">
            <div class="form-header">
                <h1>Edit Profile</h1>
                <p>Update your profile information</p>
            </div>

            <form method="post" enctype="multipart/form-data" class="profile-form">
                {% csrf_token %}

                <div class="form-group">
                    <label for="id_bio">Bio</label>
                    {{ form.bio }}
                    <div class="help-text">Tell us about yourself (optional)</div>
                    {% if form.bio.errors %}
                    <div class="message error-message">{{ form.bio.errors.0 }}</div>
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="id_avatar">Profile Picture</label>
                    <input type="file" id="id_avatar" name="avatar" accept="image/*" onchange="previewAvatar(event)">
                    <div class="help-text">Supported formats: JPG, PNG, GIF, WebP (Max 5MB)</div>
                    {% if form.avatar.errors %}
                    <div class="message error-message">{{ form.avatar.errors.0 }}</div>
                    {% endif %}

                    {% if request.user.profile.avatar %}
                    <div class="avatar-preview">
                        <img src="{{ request.user.profile.avatar.url }}" alt="Current avatar" class="avatar-image">
                        <div class="avatar-info">
                            <p>Current avatar</p>
                            <p>Upload a new image to replace it</p>
                        </div>
                    </div>
                    {% endif %}

                    <div id="newAvatarPreview" class="avatar-preview" style="display: none;">
                        <img id="previewImage" class="avatar-image" src="" alt="New avatar">
                        <div class="avatar-info">
                            <p>New avatar preview</p>
                        </div>
                    </div>
                </div>

                <div class="button-group">
                    <a href="{% url 'profile' request.user.id %}" class="btn btn-cancel">Cancel</a>
                    <button type="submit" class="btn btn-submit">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function previewAvatar(event) {
            const file = event.target.files[0];
            const preview = document.getElementById('previewImage');
            const container = document.getElementById('newAvatarPreview');

            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.src = e.target.result;
                    container.style.display = 'flex';
                };
                reader.readAsDataURL(file);
            } else {
                container.style.display = 'none';
            }
        }
    </script>
</body>

</html>